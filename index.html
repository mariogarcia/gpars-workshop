<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GPars Actors</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>GPars Actors</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_intro">1. Intro</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_what_is_gpars">1.1. What is GPars ?</a></li>
<li><a href="#_what_an_actor_is">1.2. What an actor is ?</a></li>
<li><a href="#_what_an_actor_does">1.3. What an actor does ?</a></li>
<li><a href="#_when_to_use_actors">1.4. When to use actors ?</a></li>
<li><a href="#_why_not_using_threads">1.5. Why not using threads ?</a></li>
</ul>
</li>
<li><a href="#_before_getting_started">2. Before Getting Started</a></li>
<li><a href="#_sending">3. Sending</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_our_first_actor">3.1. Our first actor</a></li>
<li><a href="#_type_of_actors">3.2. Type of actors</a></li>
<li><a href="#_send_and_forget">3.3. Send and forget</a></li>
<li><a href="#_exercise">3.4. Exercise</a></li>
<li><a href="#_send_and_block">3.5. Send And Block</a></li>
<li><a href="#_exercise_2">3.6. Exercise</a></li>
</ul>
</li>
<li><a href="#_receiving">4. Receiving</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_a_specific_type_of_messages">4.1. A specific type of messages</a></li>
<li><a href="#_different_types_of_messages">4.2. Different types of messages</a></li>
<li><a href="#_exercise_3">4.3. Exercise</a></li>
</ul>
</li>
<li><a href="#_make_actors_socialize">5. Make Actors socialize</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_joining_actors">5.1. Joining actors</a></li>
<li><a href="#_forwarding">5.2. Forwarding</a></li>
<li><a href="#_exercise_4">5.3. Exercise</a></li>
</ul>
</li>
<li><a href="#_shit_happens">6. Shit happens</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_actor_throws_an_exception">6.1. Actor throws an exception</a></li>
<li><a href="#_supervising">6.2. Supervising</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_onetoall_strategy">6.2.1. OneToAll Strategy</a></li>
<li><a href="#_onetoone_strategy">6.2.2. OneToOne Strategy</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_stateless_actors">7. Stateless Actors</a></li>
<li><a href="#_remoting">8. Remoting</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_dataflow">8.1. Dataflow</a></li>
<li><a href="#_actors">8.2. Actors</a></li>
</ul>
</li>
<li><a href="#_exercises_solutions">Appendix A: Exercises solutions</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_solution_3_4">Solution 3.4</a></li>
<li><a href="#_solution_3_6">Solution 3.6</a></li>
<li><a href="#_solution_4_3">Solution 4.3</a></li>
<li><a href="#_solution_5_3">Solution 5.3</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>By Mario Garcia &lt;<a href="https://www.twitter.com/marioggar">@marioggar</a>&gt;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_intro">1. Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This workshop objective is to learn how to create actors using GPars.</p>
</div>
<div class="sect2">
<h3 id="_what_is_gpars">1.1. What is GPars ?</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The GPars framework offers Java developers intuitive and safe ways to handle Java
or Groovy tasks concurrently. Leveraging the enormous flexibility of the
Groovy programing language and building on proven Java technologies,
we aim to make concurrent programming for multi-core hardware intuitive,
robust and enjoyable.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; GPars site
</div>
</div>
</div>
<div class="sect2">
<h3 id="_what_an_actor_is">1.2. What an actor is ?</h3>
<div class="paragraph">
<p>There are two common ways of synchronization among threads, one is the dark and full
of terrors synchronization way, and the second one is message passing. The latter
is the one actor model embraces.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The actor model in computer science is a mathematical model of concurrent
computation that treats "actors" as the universal primitives of concurrent
digital computation: in response to a message that it receives, an actor
can make local decisions, create more actors, send more messages, and determine
how to respond to the next message received</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia
</div>
</div>
<div class="paragraph">
<p>An actor provides <strong><em>isolated mutability</em></strong> and ensures that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>At most one thread</strong> processes the actor&#8217;s body</p>
</li>
<li>
<p><strong>Actor&#8217;s state can be safely modified by code in the body</strong> without any extra effort</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To make sure those conditions will remain true the programmer <strong>should be sure that actor&#8217;s code is never
invoked directly from outside</strong> the actors body.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_an_actor_does">1.3. What an actor does ?</h3>
<div class="paragraph">
<p>An actor has three main related actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Receiving messages</p>
</li>
<li>
<p>Sending messages</p>
</li>
<li>
<p>Sending replies</p>
</li>
<li>
<p>Creating new actors</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_when_to_use_actors">1.4. When to use actors ?</h3>
<div class="paragraph">
<p>Whenever you need to access a given resource from multiple threads.</p>
</div>
</div>
<div class="sect2">
<h3 id="_why_not_using_threads">1.5. Why not using threads ?</h3>
<div class="paragraph">
<p>Well, historically <strong>synchronizing threads</strong> has not been the best skill of Java programmers so
far, so to speak. Actor model eases very much the way concurrent access could be
cordinated.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Normally there is no good reason to do low level concurrent programming. It&#8217;s been always error prone and
it requires a really good understanding not only about JDK&#8217;s concurrency api but the Java memory model as well.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Scalability</strong> is the other main reason. While the JVM has a certain thread limit, any actor model implementation
normally has a pool of threads. If an actor is not doing anythin, it doesn&#8217;t consume threads.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Actors share a pool of threads, which are dynamically assigned to actors when the actors need to react to
messages sent to them. The threads are returned back to the pool once a message has been processed and the
actor is idle waiting for some more messages to arrive. Actors become detached from the underlying threads
and so a relatively small thread pool can serve potentially unlimited number of actors.
Virtually unlimited scalability in number of actors is the main advantage of event-based actors ,
which are detached from the underlying physical threads</p>
</div>
</blockquote>
<div class="attribution">
&#8212; GPars documentation
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_getting_started">2. Before Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>What do we need to do sample code ?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java<sup>tm</sup> 1.7+</p>
</li>
<li>
<p>Groovy 2.1.x</p>
</li>
<li>
<p>Gradle 1.9+</p>
</li>
<li>
<p>Git</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending">3. Sending</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Actors are all about passing messages so the first thing we are going to do is to send messages
to an actor.</p>
</div>
<div class="paragraph">
<p>For this first example we are using the GroovyConsole. So open it up and create your first actor</p>
</div>
<div class="sect2">
<h3 id="_our_first_actor">3.1. Our first actor</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint groovy language-groovy"><code><i class="conum" data-value="1"></i><b>(1)</b>
import groovyx.gpars.actor.Actors
import groovyx.gpars.actor.DefaultActor

DefaultActor receiver = Actors.actor { <i class="conum" data-value="2"></i><b>(2)</b>
    loop { <i class="conum" data-value="3"></i><b>(3)</b>
        react { String msg -&gt; <i class="conum" data-value="4"></i><b>(4)</b>
            println "Hey thanks for telling me $msg"
        }
    }
}

<i class="conum" data-value="5"></i><b>(5)</b>
receiver.send 'Message 1'
receiver &lt;&lt; 'Message 2'
receiver 'Message 3'
</code></pre>
</div>
</div>
<div class="paragraph">
<p>So few lines of code and many concepts already. Let&#8217;s review all of them.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To work with actors in GPars you should import <strong><em>groovyx.gpars.actor</em></strong> package.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Actor&#8217;s dsl is created by using <strong><em>Actors.actor</em></strong> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This actor never will end without an explicit termination</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>When <strong>reacting</strong> for a given received message, the type could be established as parameter to the react closure</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can pass messages to an actor by using the actor&#8217;s <strong>send</strong> method. This method can be invoked in the
three ways exposed in the example.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_type_of_actors">3.2. Type of actors</h3>
<div class="paragraph">
<p>GPars distinguises between <strong>stateful</strong> actors and <strong>stateless</strong> actors.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve just built a <strong><em>groovyx.gpars.actor.DefaultActor</em></strong>. A <em>DefaultActor</em> belongs to the group of stateful actors. Stateful actors
allow programmer to handle implicit state directly.</p>
</div>
<div class="paragraph">
<p>Inside stateless actors GPars has <strong><em>DynamicDispatchActor</em></strong> and <strong><em>ReactiveActor</em></strong> classes.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Depending on your requirements you can choose one or another, but it is clear stateless
actors will perform better than the stateful ones.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_send_and_forget">3.3. Send and forget</h3>
<div class="paragraph">
<p>In real applications sometimes we just want to send some data without blocking the application and forget about the
result of the data sent. A typical scenario would be logging user behavior through the application right ?</p>
</div>
<div class="listingblock">
<div class="title">Send and forget DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovy.transform.Immutable

import groovyx.gpars.actor.Actors
import groovyx.gpars.actor.DefaultActor

@Immutable <i class="conum" data-value="1"></i><b>(1)</b>
class UserItem {
    String userName
    Long itemId
}

final DefaultActor loggingServiceActor = Actors.actor {
    loop {
        react { UserItem userItem -&gt; <i class="conum" data-value="2"></i><b>(2)</b>
            println "user ${userItem.userName} added item ${userItem.itemId} at ${new Date()}"
        }
    }
}

<i class="conum" data-value="3"></i><b>(3)</b>
loggingServiceActor.send(new UserItem(userName:'Mario', itemId: 10L))
Thread.sleep(1000) // Adding a delay to see it working
loggingServiceActor &lt;&lt; ([userName: 'Rober', itemId: 20L] as UserItem)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we&#8217;are sending a message to the actor from an outer process holding the actor&#8217;s reference.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Immutability is always the right choice when dealing with concurrency and parallelism. Use it as much as you can.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The react method closure can receive as parameter any type. Of course make sure the type you expect is the one
your are actually receiving, otherwise you&#8217;ll get a cast exception.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Here is not another actor sending messages to our actor but a different thread (the main thread).</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
An actor&#8217;s message handler (react) can only expect 0 or 1 argument
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before starting the exercise, take a look how it would look like without the DSL. That will be really important when
going through the exercises.</p>
</div>
<div class="listingblock">
<div class="title">Send and forget No-DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovy.transform.Immutable

import groovyx.gpars.actor.Actors
import groovyx.gpars.actor.DefaultActor

@Immutable
class UserItem {
    String userName
    Long itemId
}

class LoggingActorService extends DefaultActor { <i class="conum" data-value="1"></i><b>(1)</b>
    void act() { <i class="conum" data-value="2"></i><b>(2)</b>
        loop {
            react { UserItem userItem -&gt;
                println """
                    user ${userItem.userName} added item ${userItem.itemId}
                    at ${new Date()}
                """
            }
        }
    }
}

class UserService {
    def loggingService <i class="conum" data-value="3"></i><b>(3)</b>

    void trackAddedItem(final UserItem userItem) {
        loggingService &lt;&lt; userItem
    }
}

def loggingService = new LoggingActorService()
def userService = new UserService(loggingService: loggingService)

loggingService.start() <i class="conum" data-value="4"></i><b>(4)</b>

userService.trackAddedItem(new UserItem(userName: 'John', itemId: 43L))
Thread.sleep(1000)
userService.trackAddedItem(new UserItem(userName: 'Ronnie', itemId: 23L))
</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Now we are explicitly declaring a DefaultActor class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Now the actor&#8217;s body is constraint within the body of the act() method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In order to be able to send messages to the actor we need its reference, so we pass it when building our service instance</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Before sending messages to our actor, the actor should be already listening otherwise you will get an exception</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_exercise">3.4. Exercise</h3>
<div class="paragraph">
<p>Create an actor receiving 4 numbers an prints all of them to the console. You can use the GroovyConsole to do that. Please
try to do it using GPars DSL and plain classes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_send_and_block">3.5. Send And Block</h3>
<div class="paragraph">
<p>Logging is really important but sometimes we just want a response as a consequence of sending data. Now we will
be sending a message to a given actor and expecting a response to that data.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we want to have some word translated we want to send the word to an actor instance and get the translation
back.</p>
</div>
<div class="listingblock">
<div class="title">SendAndWait - Reply</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.actor

final def english2SpanishService = actor {
    loop {
        react { String word -&gt;
            if (word == 'hello') {
                reply 'hola' <i class="conum" data-value="1"></i><b>(1)</b>
            } else if (word == 'goodbye') {
                reply 'adios'
            } else {
                reply 'no idea :P'
            }
        }
    }
}

String helloTranslation = english2SpanishService.sendAndWait('hello') <i class="conum" data-value="2"></i><b>(2)</b>
String goodbyeTranslation = english2SpanishService.sendAndWait('goodbye')
String seeyoulaterTranslation = english2SpanishService.sendAndWait('see you later')

assert helloTranslation == 'hola'
assert goodbyeTranslation == 'adios'
assert seeyoulaterTranslation == 'no idea :P'
</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The actor can only use the <strong><em>reply</em></strong> method from a non-actor-request when the client uses
sendAndWait for sending the message</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <strong><em>sendAndWait</em></strong> method blocks the current thread until a response has been received</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">SendAndPromise- Reply</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.actor
import groovyx.gpars.dataflow.Promise

def reallySlowService = actor {
    loop {
        react {
            Thread.sleep(2000)
            reply 43
        }
    }
}

def reallyFastService = actor {
    loop {
        react {
            reply 'No idea'
        }
    }
}

Promise answer1 =
    reallySlowService.
        sendAndPromise('Tell me the meaning of life the universe and everything')
String answer2 =
    reallyFastService.
        sendAndWait('Tellme how is gonna end 24 this season')

assert answer1.get() == 43
assert answer2 == 'No idea'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercise_2">3.6. Exercise</h3>
<div class="paragraph">
<p>Now that we now how to send and receive a simple response from a given actor, lets modify the
actor you built for the first exercise for instead of printing out the result, make it send back
the result to you.</p>
</div>
<div class="paragraph">
<p>You have to send three different list of numbers, get back the results and sum them in the client
once you have received the partial results from the actor.</p>
</div>
<div class="paragraph">
<p>The objective of this exercises is using promises or blocking calls to get results from a given actor.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_receiving">4. Receiving</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we have focused our efforts on how can we send a message to a given actor. Well in this chapter
we&#8217;ll be seeing from the other side, we will be focusing on topics such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How an actor receive messages ?</p>
</li>
<li>
<p>How can an actor respond to a given message ?</p>
</li>
<li>
<p>What type of objects can an actor receive ?</p>
</li>
<li>
<p>Is an actor capable of behave differently depending on the object received ?</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_a_specific_type_of_messages">4.1. A specific type of messages</h3>
<div class="paragraph">
<p>So far we&#8217;ve seen how to send one specific type of messages to our actors.</p>
</div>
<div class="listingblock">
<div class="title">Receiving one specific type</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.actor
import groovyx.gpars.actor.DefaultActor

final DefaultActor echoActor = actor {
    loop {
        react { String message -&gt;
            reply "Nice to hear: $message"
        }
    }
}

String response = echoActor.sendAndWait('Hi there')

assert response == "Nice to hear: Hi there"
</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
If you try to send a message with another value not expected in the actor&#8217;s closure, it will throw an exception
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_different_types_of_messages">4.2. Different types of messages</h3>
<div class="paragraph">
<p>That&#8217;s cool, but sometimes you may want to send different types of messages to a given object
and you may expect the actor to behave differently depending on the type received.</p>
</div>
<div class="paragraph">
<p>That kind of behavior is acomplished by <strong><em>DynamicDispatchActor</em></strong>. Whether you use the DSL or the
Java flavor you will be able to create different processing for different type of messages using
the same actor.</p>
</div>
<div class="listingblock">
<div class="title">Dispatching DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.messageHandler
import groovyx.gpars.actor.DynamicDispatchActor

DynamicDispatchActor handler = messageHandler {
    when { String name -&gt;
       println "Nice to meet you $name"
    }
    when { Integer age -&gt;
        println "You look younger than $age"
    }
}

handler &lt;&lt; "Mario"
handler &lt;&lt; 37
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dispatching NO-DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovyx.gpars.actor.DynamicDispatchActor

class Handler extends DynamicDispatchActor {
    void onMessage(String name) {
        println "Nice to meet you $name"
    }

    void onMessage(Integer age) {
        println "You look younger than $age"
    }

}

final Handler handler = new Handler()
handler.start()

handler &lt;&lt; "Mario"
handler &lt;&lt; 37
</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
If you send a value of a type not expected by any of the <em>when</em> clauses, it will throw an exception.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_exercise_3">4.3. Exercise</h3>
<div class="paragraph">
<p>You have to create an actor that processes national and international orders. All orders have
a field call <em>content</em> where they carry the message.</p>
</div>
<div class="paragraph">
<p>For national orders no reply is needed because all national orders are supposed to reach destination. But for international orders you need
the actor to reply with a MD5 signature of the message (I&#8217;ll give you the code to get the MD5).</p>
</div>
<div class="listingblock">
<div class="title">Getting MD5 for a given String</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static java.security.MessageDigest.getInstance

String md5(String st) {
    return getInstance("MD5").digest(st.getBytes("UTF-8")).encodeHex().toString()
}
</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_make_actors_socialize">5. Make Actors socialize</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we have been sending messages to an actor, receiving messages as an actor, and even replying as an actor but there&#8217;s one important part
missing here&#8230; I want actors to talk to each other. Lets see how to do it.</p>
</div>
<div class="sect2">
<h3 id="_joining_actors">5.1. Joining actors</h3>
<div class="paragraph">
<p>When you want callers to wait an actor to terminate you should be using actor&#8217;s <strong><em>join()</em></strong> method. Sometimes maybe
a client calling to an actor, sometimes could be an actor sending messages to another actor.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Actors provide a join() method to allow callers to wait for the actor to terminate. A variant accepting a timeout is also available</p>
</div>
</blockquote>
<div class="attribution">
&#8212; GPars official documentation
</div>
</div>
<div class="listingblock">
<div class="title">Joining DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.actor

final receiver = actor {
    loop {
        react { msg -&gt;
            reply "Replying actor received: '$msg'"
        }
    }
}

final sender = actor {
    receiver &lt;&lt; "Sent Ping"
    react { msg -&gt;
        println msg
    }
}

[receiver, sender]*.join()
println "Never reached"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Joining NO-DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.actor
import groovyx.gpars.actor.DefaultActor

class SendingActor extends DefaultActor {
    final DefaultActor destination
    SendingActor(DefaultActor destination) {
       this.destination = destination
    }
    void act() {
        println destination.sendAndWait("Sent Ping")
    }
}

class ReplyingActor extends DefaultActor {
    void act() {
        loop {
            react { String msg -&gt;
                reply "ReplyingActor received: $msg'"
            }
        }
    }
}

final receiver = new ReplyingActor().start()
final sender = new SendingActor(receiver).start()

[receiver, sender]*.join()
println "Never reached"
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_forwarding">5.2. Forwarding</h3>
<div class="paragraph">
<p>Suppose you want to send a message to a given actor and then get the response back to send it to another actor. Well good news is that you can set where the response should be sent.</p>
</div>
<div class="listingblock">
<div class="title">Simple forwarding NO-DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovyx.gpars.actor.DefaultActor

class WithId extends DefaultActor {
    String id
    String toString() { return this.id }
}

class Bank extends WithId {
    void act() {
        loop {
            react { Integer amount -&gt;
                reply "Amount $amount has been stored in -- ${sender} --"
            }
        }
    }
}
class BankBranch extends WithId {
    void act() {
        loop {
            react { String message -&gt;
                println message
            }
        }
    }
}

final branch1 = new BankBranch(id: '0001').start()
final branch2 = new BankBranch(id: '0002').start()
final bank = new Bank(id: 'SuperRichBank').start()

bank.send(1000, branch1)
bank.send(2000, branch2)

println bank.sendAndWait(3000)
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercise_4">5.3. Exercise</h3>
<div class="paragraph">
<p>You can forward messages if you know the destination but most of the time you just deliver
messages to a proxy which then, forwards the message to the proper destination.</p>
</div>
<div class="paragraph">
<p>In this exercise your boss need you to do some optimization on some
files of the corporate site.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All text files should include his name</p>
</li>
<li>
<p>All images should be resized to a certain dimension (ie 300x300)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You have to create</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1 actor acting as a proxy, so every time a file is received you must
send it to the correspondent actor to be processed.</p>
</li>
<li>
<p>1 Text processing actor</p>
</li>
<li>
<p>1 Image processing actor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every time you send a file to the proxy actor it should forward that
file to the correspondent processing actor (text files to text actor and
images to image actor).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You can solve this exercise just with <strong><em>DefaultActor</em></strong> instances
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Although not necessary you can use the Java7 WatchService to look for changes
in a given directory instead of sending files manually to your actors.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Follow up I leave a snippet to resize an image with the library <a href="https://github.com/thebuzzmedia/imgscalr">imgscalr</a>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>@Grab('org.imgscalr:imgscalr-lib:4.2')
import java.awt.image.BufferedImage
import javax.imageio.ImageIO

import org.imgscalr.Scalr

BufferedImage src = ImageIO.read(new File('//source'))
BufferedImage img = Scalr.resize(src, 300, 200)

ImageIO.write(img, 'jpg', new File('//destination'))</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shit_happens">6. Shit happens</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If something may go wrong it will go wrong. It&#8217;s a universal rule isn&#8217;t it ?</p>
</div>
<div class="sect2">
<h3 id="_actor_throws_an_exception">6.1. Actor throws an exception</h3>
<div class="paragraph">
<p>An actor terminates automatically when an exception that is not handled inside actor&#8217;s body is thrown.</p>
</div>
<div class="paragraph">
<p>Then&#8230; What happens if an actor throws an exception ? Should we try-catch the possible exception and deal with it ? Well, general
recomendation about this is <strong><em>let-it-crash</em></strong>. If we don&#8217;t add try-catch code in our actors, they will remain cleaner and will
be easier to maintain.</p>
</div>
<div class="paragraph">
<p>During the lifecycle of our actor there are some callback methods useful to use when undesirable situations such as exceptions,
interruptions, or timeouts happen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>
/* called when the actor's thread gets interrupted. Thread interruption will result
 * in the stopping the actor in any case  */
onInterrupt(InterruptedException ie)

/* called when no messages are sent to the actor within the timeout specified for
 * the currently blocking react method */
onTimeout()

/* called when an exception occurs in the actor's event handler.
 * Actor will stop after return from this method. */
onException(Throwable th)
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the worst scenario happens we would like at least to terminate the actor in an ordered and controlled way.</p>
</div>
<div class="paragraph">
<p>In order to to that all actors have the <strong><em>onException(Exception)</em></strong> method. This method is a nice place to put the code we want
to execute when a not handled exception is thrown inside the actor. That way we keep logic code away from guard code.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Remember: By default an actor stops when an exception has been thrown
within the body of the actor.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Handling an actor exception DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovyx.gpars.actor.Actors
import groovyx.gpars.actor.DefaultActor

DefaultActor buggyActor = Actors.actor {
    delegate.metaClass.onException = {
        println "Close database connection"
        println "Release other resources"
        println "Bye"
    }
    loop {
        react { String message -&gt;
            throw new Exception("Shit happens :P")
        }
    }
}

buggyActor &lt;&lt; "Something nice"
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Handling an actor exception NO-DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovyx.gpars.actor.Actors
import groovyx.gpars.actor.DefaultActor

class BuggyActor extends DefaultActor {

    void onException(Throwable th) {
        println "Close database connection"
        println "Release other resources"
        println "Bye"
    }

    void act() {
        loop {
            react { String message -&gt;
                throw new Exception("Shit happens :P")
            }
        }
    }
}

new BuggyActor().start() &lt;&lt; "Something nice"
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Well it&#8217;s nice we have a mecanism to make the actor stop nicely&#8230; but I don&#8217;t want the actor to stop receiving messages&#8230; I want
it to continue&#8230; how do I do that ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_supervising">6.2. Supervising</h3>
<div class="paragraph">
<p>Supervising is a really useful feature because you could:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get notified of changes on other actors</p>
</li>
<li>
<p>Take control over them (stopping, restarting&#8230;etc)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although GPars doesn&#8217;t have that functionality out-of-the-box yet, I&#8217;ll try to implement a very simple example on how
supervisors may look like using GPars.</p>
</div>
<div class="paragraph">
<p>First thing is to implement the skeleton of what a supervised actor may look like. A Supervised object is an actor
that can inform to its linked Supervisor before it stops, giving information about the reasons that made it stop.</p>
</div>
<div class="listingblock">
<div class="title">Supervised Actor</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>
import groovyx.gpars.actor.Actors
import groovyx.gpars.actor.DefaultActor

class SupervisedExceptionMessage { <i class="conum" data-value="1"></i><b>(1)</b>
   String message
}

class Supervised extends DefaultActor {
    Supervisor supervisor  <i class="conum" data-value="2"></i><b>(2)</b>
    void onException(Throwable th) {
        supervisor &lt;&lt; new SupervisedExceptionMessage(message: th.message) <i class="conum" data-value="3"></i><b>(3)</b>
    }
}
</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When supervised actor crashes it will create an exception message to send it to its supervisor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We need to hold a supervisor&#8217;s reference in order to be able to inform it whenever may come</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Everytime an actor throws an unhandled exception the onException(Throwable) is invoked. Once the onException() method ends
the actor stops.  Before that we want to inform the supervisor in case it wanted to do something about it.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Supervisor Actor</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovyx.gpars.actor.DynamicDispatchActor

class Supervisor extends DynamicDispatchActor { <i class="conum" data-value="1"></i><b>(1)</b>
    Supervised supervised <i class="conum" data-value="2"></i><b>(2)</b>
    Class&lt;? extends Supervised&gt; supervisedClass <i class="conum" data-value="3"></i><b>(3)</b>

    void link(Supervised supervised) { <i class="conum" data-value="4"></i><b>(4)</b>
        this.supervised = supervised
        this.supervised.supervisor = this
        this.supervisedClass = supervised.getClass()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <strong><em>Supervisor</em></strong> is an actor that supervises other actor and makes decisions whenever a supervised actor stops because a failure (an unhandled
exception most of the time).</p>
</div>
<div class="paragraph">
<p>The <strong><em>Supervisor</em></strong> instance can be linked to the supervised actor thanks to the supervisor&#8217;s link method. This method makes actors
available to each other meaning that <strong><em>Supervisor</em></strong>'s instance can receive supervised&#8217;s SupervisedExceptionMessage among other things.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A Supervisor extends <strong><em>DynamicDispatchActor</em></strong>. It could receive many other type of messages other than <strong><em>SupervisedExceptionMessage</em></strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A reference to the supervised actor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The reference to the supervised actor&#8217;s class. This is useful in case the supervisor wanted to create a new instance of a supervised
actor that stopped because of an unhandled exception.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In order to link (I took this term from Scala Akka) supervised instance to this supervisor we invoke supervisor&#8217;s link method passing
the supervised actor as parameter.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lets see how to use it.</p>
</div>
<div class="listingblock">
<div class="title">Supervising Example</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>class SimpleSupervisedActor extends Supervised {
    void act() {
        loop {
            react { String message -&gt;
                if (message == 'gift') {
                    throw new Exception(message)
                }
                println "NORMAL: $message"
            }
        }
    }
}

def supervised = new SimpleSupervisedActor().start()
def supervisor = new Supervisor() {
    void onMessage(String query) {
        supervised &lt;&lt; query
    }
    void onMessage(SupervisedException ex) {
        println "SUPERVISED ACTOR DIES WITH MESSAGE: ${ex.message}"
        supervised = supervisedClass.newInstance().start() <i class="conum" data-value="1"></i><b>(1)</b>
    }
}.start()

supervisor.link(supervised)

supervisor &lt;&lt; "something"
Thread.sleep(1000)
supervisor &lt;&lt; "something"
Thread.sleep(1000)
supervisor &lt;&lt; "gift"
Thread.sleep(1000)
supervisor &lt;&lt; "Message processed by a new supervised instance 1"
Thread.sleep(1000)
supervisor &lt;&lt; "Message processed by a new supervised instance 2"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time we have two actors. We&#8217;ve got a <strong><em>Supervised</em></strong> actor receiving messages through its <strong><em>Supervisor</em></strong>. This way in case the
supervised actor stops, its Supervisor could still create another Supervised actor of the same type and keep processing messages transparently
to the client.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The interesting part. Supervisor receives a Supervised&#8217;s <strong><em>SupervisedException</em></strong> message when it&#8217;s about to stop. Then the Supervisor instance
has chosen to create another Supervised instance to keep processing messages the same way.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enough to say, the more stateless is the Supervised actor the less difficult will be to <em>restart</em> the Supervised actor again</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>What "restart" means ?</em></strong> In this example, and in general, in other JVM&#8217;s implementations, to restart and actor is eventually creating a new instance
of the same type of the stopped actor. That&#8217;s why it&#8217;s so important to keep your actor instances stateless. If you had some state you should be serializing
the state of the actor in order to recreate the state later on.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_onetoall_strategy">6.2.1. OneToAll Strategy</h4>
<div class="paragraph">
<p>(TODO) or</p>
</div>
</div>
<div class="sect3">
<h4 id="_onetoone_strategy">6.2.2. OneToOne Strategy</h4>
<div class="paragraph">
<p>(TODO) and</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stateless_actors">7. Stateless Actors</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_remoting">8. Remoting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Remoting has become part of GPars since version <code>1.3-SNAPSHOT</code> . That&#8217;s great news!!!! Until
this moment all actors should run in the same JVM in order to be able to
communicate each other. Now you can be running an actor in one machine sending
messages to another in another machine.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
You can find more information about remoting at GPars ascii documentation, and
at this codehaus page <a href="http://docs.codehaus.org/display/GPARS/2014/09/06/Remoting+for+GPars">Confluence</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_dataflow">8.1. Dataflow</h3>
<div class="paragraph">
<p>Although this documentation is all about actors, I&#8217;ve added some extra
examples about remoting because I think remoting is going to be one
of the most important features of GPars in the near future.</p>
</div>
<div class="paragraph">
<p>When working with remote dataflows the most
important classes to keep in mind are:</p>
</div>
<div class="listingblock">
<div class="title">imports</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovyx.gpars.dataflow.DataflowVariable
import groovyx.gpars.dataflow.remote.RemoteDataflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example just runs a server instance which publish a dataflow
variable and a client asking for the value of the dataflow variable
published at the server.</p>
</div>
<div class="paragraph">
<p>First of all lets see how to build the server:</p>
</div>
<div class="listingblock">
<div class="title">Server</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>    RemoteDataflows startServer() {
        def dataflows = RemoteDataflows.create() <i class="conum" data-value="1"></i><b>(1)</b>
        dataflows.startServer('localhost',9000) <i class="conum" data-value="2"></i><b>(2)</b>
        def variable = new DataflowVariable() <i class="conum" data-value="3"></i><b>(3)</b>
        variable &lt;&lt; 42
        dataflows.publish(variable,"meaning-of-life") <i class="conum" data-value="4"></i><b>(4)</b>

        return dataflows
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an instance of a <code>RemoteDataflows</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Stablishing the address and port of the server instance and start
the server instance. Notice that what <code>startServer</code> returns is not an instance
of <code>RemoteDataflows</code> but an instance of <code>LocalHost</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declaring a dataflow variable and setting a value</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Publishing the dataflow variable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And then it&#8217;s time to create the client:</p>
</div>
<div class="listingblock">
<div class="title">Client</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>    void 'reading a simple dataflow variable'() {
        setup: 'starting server exposing dataflow variable'
            def serverDataflows = startServer() <i class="conum" data-value="1"></i><b>(1)</b>
        when: 'listening to that server'
            def clientDataflows = RemoteDataflows.create() <i class="conum" data-value="2"></i><b>(2)</b>
            def remoteVariablePromise = <i class="conum" data-value="3"></i><b>(3)</b>
                clientDataflows.getVariable(
                    "localhost",
                    9000,
                    "meaning-of-life"
                )
        and: 'asking for a given dataflow variable'
            def result = remoteVariablePromise.get() <i class="conum" data-value="4"></i><b>(4)</b>
        then: 'you should get what you expected'
            result.value == 42
        cleanup: 'stopping server instance'
            serverDataflows.stopServer() <i class="conum" data-value="5"></i><b>(5)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Now it&#8217;s time to build and run the server</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>RemoteDataflows</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Getting a pointer to the dataflow variable published at the
server</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Once we get the reference we can start asking for the variable&#8217;s value</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Stopping the server</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_actors">8.2. Actors</h3>
<div class="paragraph">
<p>The way actors are published is very similar than the way dataflows were published. Instead
of using the <code>RemoteDataflows</code> we will be using the <code>RemoteActors</code> instance.</p>
</div>
<div class="paragraph">
<p><code>RemoteActors</code> have <code>2</code> responsabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>To create</code> a remote actor&#8217;s server: Actors' instances will be <code>published</code> to that server using
an id (a simple string).</p>
</li>
<li>
<p>To enable clients <code>to get a reference</code> of remote actors: That will be possible by
setting address, port and the actor&#8217;s identifier at the server.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Imports</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.actor
import groovyx.gpars.actor.remote.RemoteActors</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Full example</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>    void 'simple remote actors test'() {
        given: 'a remote actor server'
            <i class="conum" data-value="1"></i><b>(1)</b>
            def remoteActorServer = RemoteActors.create()
            remoteActorServer.startServer('localhost',9000)
        and: 'a simple DefaultActor instance'
            <i class="conum" data-value="2"></i><b>(2)</b>
            def simpleActor = actor {
                loop {
                    react { String msg -&gt;
                        reply "Thanks for saying: $msg"
                    }
                }
            }
        when: 'publishing the actor remotely'
            <i class="conum" data-value="3"></i><b>(3)</b>
            remoteActorServer.publish(simpleActor, 'greetingsActor')
        and: 'getting the actor reference'
            <i class="conum" data-value="4"></i><b>(4)</b>
            def remoteActorsClient = RemoteActors.create()
            def actorPromise =
                remoteActorsClient
                    .get('localhost', 9000, 'greetingsActor')
            <i class="conum" data-value="5"></i><b>(5)</b>
            def remoteActor = actorPromise.get()
        and: 'sending a message to actor'
            <i class="conum" data-value="6"></i><b>(6)</b>
            def result = remoteActor.sendAndWait('hello')
        then: 'the reply should be the expected'
             result == 'Thanks for saying: hello'
        cleanup: 'shutting down the actor server'
            remoteActorServer.stopServer()
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creating the <code>RemoteActors</code> instance. This instance will create the remote server
where actors will be published.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is a regular <code>groovyx.gpars.actor.DefaultActor</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Publishing the actor&#8217;s instance to the server</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creating another <code>RemoteActors</code> instance to simulate client won&#8217;t be able to
access the server <code>RemoteActors</code> instance. Once we get the <code>RemoteActors</code> instance
we ask for the actor instance published with the id <code>greetingsActor</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>RemoteActors</code> instance returned a promise containing the
requested actor.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Then we can send messages (serialized) to the remote actor like if
we had the actor working locally.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercises_solutions">Appendix A: Exercises solutions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_solution_3_4">Solution 3.4</h3>
<div class="listingblock">
<div class="title">Solution DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.actor

def printer = actor {
    loop {
        react { List&lt;Integer&gt; numbers -&gt;
           println numbers.sum()
        }
    }
}

printer &lt;&lt; (1..4) as List
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Solution NO-DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovyx.gpars.actor.DefaultActor

class Printer extends DefaultActor {
    void act() {
        loop {
            react { numbers -&gt;
                println numbers.sum()
            }
        }
    }
}

def printer = new Printer()
printer.start()
printer &lt;&lt; (1..4)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_3_6">Solution 3.6</h3>
<div class="listingblock">
<div class="title">Solution DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.actor
import groovyx.gpars.dataflow.Promise

def printer = actor {
    loop {
        react { List&lt;Integer&gt; numbers -&gt;
           reply numbers.sum()
        }
    }
}

Promise first = printer.sendAndPromise((1..4))
Integer second = printer.sendAndWait((4..8))
Integer third = printer.sendAndWait((8..12))

assert (first.get() + second + third) == 90</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Solution NO-DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import groovyx.gpars.actor.DefaultActor
import groovyx.gpars.dataflow.Promise

class Printer extends DefaultActor {
    void act() {
        loop {
            react { numbers -&gt;
                reply numbers.sum()
            }
        }
    }
}

def printer = new Printer()
printer.start()

Promise first = printer.sendAndPromise((1..4))
Integer second = printer.sendAndWait((4..8))
Integer third = printer.sendAndWait((8..12))

assert (first.get() + second + third) == 90

</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_4_3">Solution 4.3</h3>
<div class="listingblock">
<div class="title">Solution DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>
import static groovyx.gpars.actor.Actors.messageHandler
import static java.security.MessageDigest.getInstance

import groovyx.gpars.actor.DynamicDispatchActor
import groovyx.gpars.dataflow.Promise

class Order { String content }
class NationalOrder extends Order {}
class InternationalOrder extends Order {}

final Closure&lt;String&gt; md5 = { String st -&gt;
    return getInstance("MD5").digest(st.getBytes("UTF-8")).encodeHex().toString()
}

final DynamicDispatchActor orderProcessor = messageHandler {
    when { InternationalOrder international -&gt;
        reply md5(international.content)
    }
    when { NationalOrder national -&gt;
        println "I'm sure the order: ${national.content} will be delivered"
    }
}

Promise md5IdPromise =
    orderProcessor.sendAndPromise(new InternationalOrder(content: 'supersecret'))

orderProcessor &lt;&lt; new NationalOrder(content: 'something really silly')
orderProcessor &lt;&lt; new NationalOrder(content: 'something as silly as the previous one')

println "I need to hold the id: ${md5IdPromise.get()}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Solution NO-DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import static groovyx.gpars.actor.Actors.messageHandler
import static java.security.MessageDigest.getInstance

import groovyx.gpars.actor.DynamicDispatchActor
import groovyx.gpars.dataflow.Promise

class Order { String content }
class NationalOrder extends Order {}
class InternationalOrder extends Order {}

class OrderProcessor extends DynamicDispatchActor {
    String md5(String st) {
        return getInstance("MD5").digest(st.getBytes("UTF-8")).encodeHex().toString()
    }
    void onMessage(InternationalOrder international) {
        reply md5(international.content)
    }
    void onMessage(NationalOrder national) {
        println "I'm sure the order: ${national.content} will be delivered"
    }
}

final OrderProcessor orderProcessor = new OrderProcessor().start()
final Promise md5IdPromise =
    orderProcessor.sendAndPromise(new InternationalOrder(content: 'supersecret'))

orderProcessor &lt;&lt; new NationalOrder(content: 'something really silly')
orderProcessor &lt;&lt; new NationalOrder(content: 'something as silly as the previous one')

println "I need to hold the id: ${md5IdPromise.get()}"
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_5_3">Solution 5.3</h3>
<div class="listingblock">
<div class="title">DSL</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>@Grab('org.imgscalr:imgscalr-lib:4.2')
import static javax.imageio.ImageIO.read
import static javax.imageio.ImageIO.write
import static org.imgscalr.Scalr.resize
import static groovyx.gpars.actor.Actors.actor
import static java.io.File.createTempFile

import groovyx.gpars.actor.DefaultActor

final DefaultActor imageActor = actor {
    loop {
        react { File image -&gt;
            def src = read(image)
            def img = resize(src, 400, 300)

            write(img, 'jpg', createTempFile('actors_', image.name))

            println "IMAGE: ${image.name} processed"
        }
    }
}

final DefaultActor textActor = actor {
    loop {
        react { File textFile -&gt;
            def dst = createTempFile('actors_', textFile.name)

            // Don't do this at home :P
            dst &lt;&lt; "Author: MYBOSS"
            dst &lt;&lt; textFile.text

            println "TEXT: ${textFile.name} processed"
        }
    }

}

final DefaultActor dispatchingActor = actor {
    loop {
        react { File file -&gt;
            if (file.name.endsWith('jpg')) {
                imageActor &lt;&lt; file
            } else if (file.name.endsWith('txt')) {
                textActor &lt;&lt; file
            }
        }
    }
}

new File('/somedirwithfiles/').
    listFiles().each { dispatchingActor &lt;&lt; it }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the NO-DSL version has its own Spock Specification it has been organized in several classes.</p>
</div>
<div class="listingblock">
<div class="title">Actor acting as a Proxy (NO-DSL)</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package exercises.forwarding.images

import groovyx.gpars.actor.DefaultActor

class FileProcessorActor extends DefaultActor {

    DefaultActor imageActor
    DefaultActor textActor

    void act() {
        loop {
            react { File file2Process -&gt;
                println "Start to processing ${file2Process.name}"
                if (isImageFile(file2Process)) {
                    sendToImageActor(file2Process)
                }
                if (isTextFile(file2Process)) {
                    sendToTextActor(file2Process)
                }
            }
        }
    }

    Boolean isImageFile(File file2Process) {
        return doesItEndWith(file2Process, 'jpg')
    }

    Boolean isTextFile(File file2Process) {
        return doesItEndWith(file2Process, 'txt')
    }

    Boolean doesItEndWith(File file, String ending) {
        return file.name.endsWith(ending)
    }

    void sendToImageActor(File file) {
        imageActor &lt;&lt; file
    }

    void sendToTextActor(File file) {
        textActor &lt;&lt; file
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Actor processing images (NO-DSL)</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package exercises.forwarding.images

import static javax.imageio.ImageIO.read
import static javax.imageio.ImageIO.write
import static org.imgscalr.Scalr.resize
import static java.io.File.createTempFile

import exercises.test.NotificationActor
import groovyx.gpars.actor.DefaultActor

class ImageProcessorActor extends NotificationActor {

    ImageProcessorActor(DefaultActor monitor) {
        super(monitor)
    }

    void act() {
        loop {
            react { File image -&gt;
                def src = read(image)
                def img = resize(src, 300, 200)
                def tmp = new File(System.getProperty('java.io.tmpdir'))

                write(img, 'jpg', new File(tmp, "processed_${image.name}"))

                notifyIfMonitor(image.name)
            }
        }
    }

}
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Actor processing text files (NO-DSL)</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package exercises.forwarding.images

import static java.io.File.createTempFile

import exercises.test.NotificationActor
import groovyx.gpars.actor.DefaultActor

class TextProcessorActor extends NotificationActor {

    TextProcessorActor(DefaultActor monitor) {
        super(monitor)
    }

    void act() {
        loop {
            react { File textFile -&gt;
                def tmpfile = new File(System.getProperty('java.io.tmpdir'))
                def newFile = new File(tmpfile, "processed_${textFile.name}")

                newFile &lt;&lt; 'Author: me'
                newFile &lt;&lt; textFile.text

                notifyIfMonitor(textFile.name)
            }
        }
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Specification (NO-DSL)</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package exercises.forwarding.images

import static groovyx.gpars.actor.Actors.actor

import exercises.test.NotifiedActor
import spock.lang.Specification

class ImagesProcessingSpecification extends Specification {

    final File RESOURCES_DIR = 'src/test/resources/exercises/forwarding/images/' as File
    final File TEMPORARY_DIR = new File(System.getProperty('java.io.tmpdir'))

    def 'Processing successfully images'() {
        setup: 'Creating needed directories references'
            def monitorActor = new NotifiedActor(3).start()
            def imageActor   = new ImageProcessorActor(monitorActor).start()
            def textActor    = new TextProcessorActor(monitorActor).start()
            def proxyActor   = new FileProcessorActor(imageActor: imageActor, textActor: textActor).start()
        when: 'Sending a couple of image files'
            proxyActor &lt;&lt; new File(RESOURCES_DIR, 'image1.jpg')
            proxyActor &lt;&lt; new File(RESOURCES_DIR, 'image2.jpg')
            proxyActor &lt;&lt; new File(RESOURCES_DIR, 'text.txt')
        and: 'Expecting process to finish'
            monitorActor.join()
        and: 'Looking for processed files'
            def file1 = new File(TEMPORARY_DIR, 'processed_text.txt')
            def file2 = new File(TEMPORARY_DIR, 'processed_image1.jpg')
            def file3 = new File(TEMPORARY_DIR, 'processed_image2.jpg')
        then: 'We should make sure they exist'
            [file1, file2, file3].every { it.exists() }
        cleanup: 'Deleting processed files'
            [file1, file2, file3]*.delete()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;ve used the <strong><em>NotificationActor</em></strong> and <strong><em>NotifiedActor</em></strong> to make tests wait until everything
has been processed.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-09-21 11:49:00 CEST
</div>
</div>
</body>
</html>